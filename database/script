DROP TABLE PURCHASING CASCADE CONSTRAINTS ; 

CREATE TABLE PURCHASING ( 
  BRAN_NO               NUMBER (2), 
  PUR_TYPE_SER          NUMBER (10)   NOT NULL, 
  PUR_TYPE_NO           NUMBER (2), 
  PUR_DATE              DATE, 
  SUPP_NO               NUMBER (10), 
  ORDER_NO              NUMBER (10)   NOT NULL, 
  ORDER_DATE            DATE, 
  STATUS                NUMBER (2), 
  COMMENTS              VARCHAR2 (500), 
  CREATED_USER          NUMBER (8), 
  CREATED_DATE          DATE, 
  DEP_NO                NUMBER, 
  SECTION_APPROVE       NUMBER (8), 
  SECTION_APPROVE_DATE  DATE, 
  MANAGER_APPROVE       NUMBER (8), 
  MANAGER_APPROVE_DATE  DATE, 
  RFQ_SER               NUMBER, 
  RFQ_DATE              DATE, 
  CURR_NO               NUMBER (3), 
  PRINT_COU             NUMBER (10)   DEFAULT 0, 
  CPL_MNG_APPROVE       NUMBER (8), 
  CPL_MNG_APPROVE_DATE  DATE, 
  SNRMNG_APPROVE        NUMBER (8), 
  SNRMNG_DATE           DATE, 
  MNG_REMARK            VARCHAR2 (200), 
  SMNG_REMARK           VARCHAR2 (200), 
  SCM_REMARK            VARCHAR2 (200), 
  SEC_REMARK            VARCHAR2 (200), 
  MNG_RE_DATE           DATE, 
  SMNG_RE_DATE          DATE, 
  SCM_RE_DATE           DATE, 
  SEC_RE_DATE           DATE, 
  DIS_AMNT              NUMBER (10,2), 
  OTH_AMT               NUMBER (10,2), 
  VAT                   NUMBER (7,2), 
  A                     NUMBER, 
  B                     NUMBER, 
  CANCEL_DATE           DATE, 
  CONSTRAINT PURCHASING_PK
  PRIMARY KEY ( PUR_TYPE_SER ) ) ; 

ALTER TABLE PURCHASING ADD 
 FOREIGN KEY (PUR_TYPE_NO) 
  REFERENCES PETRO.PURCHASING_TYPE (PUR_TYPE_NO) ;



CREATE OR REPLACE TRIGGER PURCHASING_DEL
after  update  ON purchasing REFERENCING NEW AS NEW OLD AS OLD FOR EACH ROW
BEGIN
   if :new.status = 2 then
    INSERT INTO purchasing_delete select  *  from  purchasing  where purchasing.PUR_TYPE_SER=:old.PUR_TYPE_SER;
	else
	null;
	end if;
END;
/

DROP TABLE PURCHASING_DETAILS CASCADE CONSTRAINTS ; 

CREATE TABLE PURCHASING_DETAILS ( 
  BRAN_NO       NUMBER (2), 
  PUR_TYPE_SER  NUMBER (10), 
  SUPP_NO       NUMBER (10), 
  GROUP_NO      NUMBER (10), 
  ITEM_NO       NUMBER (38), 
  DESCRIPTION   VARCHAR2 (500), 
  QUANTITY      NUMBER (20,2), 
  UNIT_PRICE    NUMBER (20,4), 
  SUPPLY_DATE   DATE, 
  SELECT_ITEM   NUMBER (2), 
  PART_NO       VARCHAR2 (100) ) ; 

DROP TABLE PURCHASING_ITEMS_TAB CASCADE CONSTRAINTS ; 

CREATE TABLE PURCHASING_ITEMS_TAB ( 
  BRAN_NO            NUMBER (2)    DEFAULT 1, 
  GROUP_NO           NUMBER (5)    NOT NULL, 
  ITEM_NO            NUMBER (10)   NOT NULL, 
  UNIT_NO            NUMBER (2)    DEFAULT 1, 
  ITEM_NAME_ARABIC   NVARCHAR2 (120), 
  ITEM_NAME_ENGLISH  VARCHAR2 (1000), 
  DESCRIPTION        VARCHAR2 (1000), 
  MINIMUM_STOCK      NUMBER (20,2), 
  PART_NO            VARCHAR2 (50), 
  PRECENT_INCREASE   NUMBER (5,2), 
  REORDER_LEVEL      NUMBER (20,2), 
  LEAD_TIME          NUMBER (4,2), 
  REORDER_FLAG       NUMBER (1), 
  EXPIRY_DIFF        NUMBER (2), 
  SERIALIZED         NUMBER (1), 
  ITEM_NO1           NUMBER (10), 
  MANUF              VARCHAR2 (50), 
  BRAND              VARCHAR2 (50), 
  CREATED_USER       NUMBER (8), 
  CREATED_DATE       DATE          DEFAULT sysdate, 
  ACTIVE_FLAG        NUMBER (2)    DEFAULT 1, 
  STORE_UPDATE_FLAG  NUMBER, 
  W_ITEM_NO          VARCHAR2 (20), 
  OLD_GROUP_NO       NUMBER, 
  PRIMARY KEY ( ITEM_NO ) ) ; 

ALTER TABLE PURCHASING_ITEMS_TAB ADD 
 FOREIGN KEY (BRAN_NO) 
  REFERENCES PETRO.COMPANY (BRAN_NO) ;



DROP TABLE PURCHASING_TYPE CASCADE CONSTRAINTS ; 

CREATE TABLE PURCHASING_TYPE ( 
  PUR_TYPE_NO    NUMBER (2)    NOT NULL, 
  PUR_TYPE_NAME  VARCHAR2 (40), 
  PUR_TYPE_SER   NUMBER (10), 
  PRIMARY KEY ( PUR_TYPE_NO ) ) ; 

DROP TABLE RFQ_SUPPLIERS CASCADE CONSTRAINTS ; 

CREATE TABLE RFQ_SUPPLIERS ( 
  BRAN_NO        NUMBER (2), 
  RFQ_SER        NUMBER (10)   NOT NULL, 
  SUPP_NO        NUMBER (10)   NOT NULL, 
  RESPONSE_DATE  DATE, 
  RESPONSE       NUMBER (2), 
  COMMENTS       VARCHAR2 (60), 
  INVOICE_NO     VARCHAR2 (70), 
  CONSTRAINT RFQ_SUPPLIERS_PK
  PRIMARY KEY ( RFQ_SER, SUPP_NO ) ) ; 

ALTER TABLE RFQ_SUPPLIERS ADD  CONSTRAINT RFQ_SUPPLIERS_R01
 FOREIGN KEY (RFQ_SER) 
  REFERENCES PETRO.RFQ (RFQ_SER) ;


DROP TABLE RFQ CASCADE CONSTRAINTS ; 

CREATE TABLE RFQ ( 
  BRAN_NO               NUMBER (2), 
  RFQ_SER               NUMBER (10)   NOT NULL, 
  RFQ_DATE              DATE, 
  RFQ_CLOSE_DATE        DATE, 
  ORDER_NO              NUMBER (10), 
  STATUS                NUMBER (2), 
  COMMENTS              VARCHAR2 (500), 
  CREATED_USER          NUMBER (8), 
  CREATED_DATE          DATE, 
  DEP_NO                NUMBER, 
  SECTION_APPROVE       NUMBER (8), 
  SECTION_APPROVE_DATE  DATE, 
  TERM_NO               NUMBER (5), 
  LOC_NO                NUMBER (5), 
  CONSTRAINT RFQ_PK
  PRIMARY KEY ( RFQ_SER ) ) ; 

DROP TABLE RFQ_DETAILS CASCADE CONSTRAINTS ; 

CREATE TABLE RFQ_DETAILS ( 
  BRAN_NO      NUMBER (2), 
  RFQ_SER      NUMBER (10)   NOT NULL, 
  SUPP_NO      NUMBER (10)   NOT NULL, 
  GROUP_NO     NUMBER (10), 
  ITEM_NO      NUMBER (20)   NOT NULL, 
  DESCRIPTION  VARCHAR2 (1000), 
  QUANTITY     NUMBER (20,2), 
  UNIT_PRICE   NUMBER (20,2), 
  SUPPLY_DATE  DATE, 
  CONSTRAINT RFQ_DETAILS_PK
  PRIMARY KEY ( ITEM_NO, RFQ_SER, SUPP_NO ) ) ; 

ALTER TABLE RFQ_DETAILS ADD  CONSTRAINT RFQ_DETAILS_FK1
 FOREIGN KEY (RFQ_SER, SUPP_NO) 
  REFERENCES PETRO.RFQ_SUPPLIERS (RFQ_SER, SUPP_NO) ;


DROP TABLE RFQ_DETAILS_SUPP CASCADE CONSTRAINTS ; 

CREATE TABLE RFQ_DETAILS_SUPP ( 
  BRAN_NO      NUMBER (2), 
  RFQ_SER      NUMBER (10), 
  SUPP_NO      NUMBER (10), 
  GROUP_NO     NUMBER (10), 
  ITEM_NO      NUMBER (10), 
  DESCRIPTION  VARCHAR2 (500), 
  QUANTITY     NUMBER (20,2), 
  UNIT_PRICE   NUMBER (20,2), 
  SUPPLY_DATE  DATE ) ; 
